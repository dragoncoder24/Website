<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Captain Jack's Digital Manifest</title>
    <link href="https://fonts.googleapis.com/css2?family=Pirata+One&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        /* 
        =========================================================
        Theme variables
        Change these if you want a different mood.
        Or if you regret your life choices.
        =========================================================
        */
        :root {
            --gold: #dcd0a7;
            --paper: #e8d5b5;
            --ink: #2c1e16;
            --sea: #1b1b2f;
            --accent: #a02d2d;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background: var(--sea) url('https://www.transparenttextures.com/patterns/dark-leather.png');
            color: var(--paper);
            font-family: 'Special Elite', serif;
            transition: background 1s ease, filter 0.5s ease;
            overflow-x: hidden;
        }

        /* 
        =========================================================
        Floating compass UI
        Does not point north.
        Follows your mouse because it can.
        =========================================================
        */
        #compass-ui {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 120px;
            height: 120px;
            z-index: 1000;
            filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.8));
            pointer-events: none;
        }

        #needle {
            width: 100%;
            height: 100%;
            transition: transform 0.15s ease-out;
            transform-origin: center;
        }

        header {
            text-align: center;
            padding: 60px 20px;
            animation: sway 8s ease-in-out infinite alternate;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent);
        }

        @keyframes sway {
            0% {
                transform: rotate(-1.5deg);
            }

            100% {
                transform: rotate(1.5deg);
            }
        }

        h1 {
            font-family: 'Pirata One', cursive;
            font-size: 5rem;
            color: var(--gold);
            margin: 0;
            text-shadow: 4px 4px 0px #000;
        }

        nav {
            display: flex;
            justify-content: space-between;
            /* Pushes title to left, links to right */
            align-items: center;
            padding: 15px 40px;
            background: rgba(0, 0, 0, 0.8);
            border-top: 2px solid var(--gold);
            border-bottom: 2px solid var(--gold);
            position: sticky;
            top: 0;
            z-index: 900;
            backdrop-filter: blur(10px);
        }

        nav a {
            color: var(--gold);
            text-decoration: none;
            font-family: 'Pirata One', cursive;
            font-size: 1.5rem;
            cursor: pointer;
            transition: 0.3s;
            border: 1px solid transparent;
            padding: 5px 15px;
        }

        nav a:hover {
            color: white;
            background: var(--accent);
            border: 1px solid var(--gold);
        }


        .container {
            max-width: 1100px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .manifest,
        .log-book {
            background: var(--paper) url('https://www.transparenttextures.com/patterns/old-map.png');
            color: var(--ink);
            padding: 40px;
            border: 10px solid transparent;
            border-image: url('https://www.transparenttextures.com/patterns/dark-leather.png') 30 round;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.9);
        }

        .log-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            align-items: start;
        }

        /* Responsive Layout for Mobile */
        @media (max-width: 768px) {
            .log-layout {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 3rem;
            }
        }

        @media (max-width: 768px) {
            nav {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
        }

        #mini-log h3,
        .sidebar-box h3 {
            font-family: 'Pirata One';
            font-size: 2rem;
            margin-top: 0;
            text-align: center;
        }

        #mini-log-list {
            list-style: none;
            padding: 0;
            max-height: 400px;
            overflow-y: auto;
        }

        #mini-log-list li {
            font-size: 0.85rem;
            padding: 10px 0;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.3s ease;
            line-height: 1.4;
        }

        .post-item {
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
            padding-bottom: 20px;
        }

        .post-item h3 {
            font-family: 'Pirata One';
            font-size: 2.2rem;
            margin: 0;
        }

        .pirate-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid var(--ink);
            font-family: 'Special Elite';
        }

        .pirate-btn {
            background: var(--ink);
            color: var(--gold);
            border: 1px solid var(--gold);
            padding: 10px 20px;
            font-family: 'Pirata One';
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
        }

        .pirate-btn:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.02);
        }

        .lantern {
            position: fixed;
            top: 25px;
            right: 25px;
            z-index: 1001;
            cursor: pointer;
            font-size: 2.5rem;
            filter: drop-shadow(0 0 10px gold);
        }

        .night-mode {
            background-color: #05050a !important;
            filter: sepia(0.3) brightness(0.7);
        }

        .status-msg {
            text-align: center;
            font-style: italic;
            margin-top: 10px;
            color: var(--ink);
            font-size: 0.85rem;
        }

        /* Visibility Logic */
        .admin-only {
            display: none;
        }

        .is-admin .admin-only {
            display: block;
        }

        .is-admin #admin-btn,
        .is-admin #pass-input-area {
            display: none;
        }

        .logout-btn {
            margin-top: 10px;
            background: var(--accent);
            font-size: 0.8rem;
            padding: 5px;
        }

        #pass-input-area {
            display: none;
            margin-top: 10px;
            border: 1px solid var(--ink);
            padding: 10px;
            background: rgba(0, 0, 0, 0.05);
        }

        #admin-btn {
            opacity: 0.4;
            font-size: 0.8rem;
            margin-top: 20px;
            background: transparent;
        }

        #admin-btn:hover {
            opacity: 1;
        }

        .timestamp-label {
            display: block;
            font-size: 0.7rem;
            opacity: 0.7;
            text-transform: uppercase;
            margin-bottom: 2px;
        }

        .sidebar-box {
            background: rgba(0, 0, 0, 0.03);
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
    </style>
</head>

<body id="hull">

    <div class="lantern" onclick="blowOutTheCandle()">üïØÔ∏è</div>

    <div id="compass-ui">
        <svg id="needle" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="none" stroke="#dcd0a7" stroke-width="2" />
            <path d="M50 5 L60 50 L50 95 L40 50 Z" fill="#a02d2d" />
            <circle cx="50" cy="50" r="5" fill="#dcd0a7" />
        </svg>
    </div>

    <header>
        <h1 id="header-title">The Captain's Manifest</h1>
        <p id="header-quote">"Not all treasure is silver and gold, mate."</p>
    </header>

    <nav>
        <span style="color: var(--gold); font-family: 'Pirata One'; font-size: 1.8rem; letter-spacing: 2px;">
            THE BLACK PEARL
        </span>
        <a href="index.html">Home</a>
    </nav>

    <div class="container">
        <div class="log-layout">
            <aside id="sidebar">
                <!-- Mini Logs Section -->
                <div class="sidebar-box" id="mini-log">
                    <h3>Scattered Thoughts</h3>
                    <ul id="mini-log-list"></ul>

                    <div class="admin-only">
                        <hr style="border:0; border-top: 1px solid var(--ink); opacity: 0.2; margin: 15px 0;">
                        <h4 style="font-family:'Pirata One'; margin: 0 0 10px 0;">Quick Scribble</h4>
                        <input type="text" id="mini-title" class="pirate-input"
                            placeholder="A momentary distraction...">
                        <button class="pirate-btn" style="width:100%" onclick="spillTheInk('mini')">Seal the
                            Scrawl</button>
                    </div>
                </div>

                <!-- Subscription Section -->
                <div class="sidebar-box">
                    <h3>Join the Crew</h3>
                    <p style="font-size: 0.8rem; text-align: center; margin-bottom: 15px;">Send your bird to receive
                        word of new tales.</p>
                    <input type="email" id="sub-email" class="pirate-input"
                        placeholder="Your bird's address (Email)...">
                    <button class="pirate-btn" style="width:100%" onclick="signTheArticles()">Sign the Articles</button>
                    <div id="sub-status" class="status-msg"></div>
                </div>

                <!-- Admin Controls -->
                <div id="admin-controls" style="padding: 0 10px;">
                    <div id="jack-speak" class="status-msg">"The sea is calm... for now."</div>

                    <div class="admin-only">
                        <button class="pirate-btn logout-btn" style="width:100%; margin-top: 10px;"
                            onclick="abandonShip()">Abandon Ship</button>
                    </div>

                    <button id="admin-btn" class="pirate-btn" style="width:100%" onclick="summonCaptain()">Captain's
                        Quarters</button>

                    <div id="pass-input-area">
                        <input type="email" id="captain-email" class="pirate-input" placeholder="Identify yourself...">
                        <input type="password" id="captain-pass" class="pirate-input"
                            placeholder="The Secret Parlay...">
                        <button class="pirate-btn" id="login-trigger" style="width:100%"
                            onclick="identifyCaptain()">Unlock</button>
                    </div>
                </div>
            </aside>

            <main class="manifest">
                <div id="log-form" class="admin-only"
                    style="margin-bottom: 40px; border-bottom: 2px dashed var(--ink); padding-bottom: 20px;">
                    <h2 style="font-family:'Pirata One'; margin-top: 0;">New Manifest Entry</h2>
                    <input type="text" id="post-title" class="pirate-input" placeholder="Title of the Tale...">
                    <textarea id="post-content" class="pirate-input" style="height:120px"
                        placeholder="Speak your truth, matey..."></textarea>
                    <button class="pirate-btn" onclick="spillTheInk('main')">Commit to History</button>
                </div>

                <div id="blog-posts">
                </div>
            </main>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        /* 
       =========================================================
       Firebase configuration
       I see the gears working in your mind!
       If this leaks, rotate keys.
       If it breaks, check the console first.
       =========================================================
       */
        const pirateManifesto = {
            apiKey: "AIzaSyDKasz4tQvuDCa1kr316Wlu8O02gQK_TJk",
            authDomain: "personal-web-9d89f.firebaseapp.com",
            databaseURL: "https://personal-web-9d89f-default-rtdb.firebaseio.com",
            projectId: "personal-web-9d89f",
            storageBucket: "personal-web-9d89f.firebasestorage.app",
            messagingSenderId: "1036303076300",
            appId: "1:1036303076300:web:e02931ed8525781f84ab69",
            measurementId: "G-Q7G9D7X30Y"
        };

        const blackPearl = initializeApp(pirateManifesto);
        const mapRoom = getFirestore(blackPearl);
        const quartermaster = getAuth(blackPearl);

        const theGreatTales = 'main_logs';
        const theWhispers = 'mini_logs';
        const theArticles = 'subscribers';

        let theCaptain = null;
        let mainLogStream = null;
        let miniLogStream = null;

        // --- WATCHING FOR THE CAPTAIN ---
        onAuthStateChanged(quartermaster, (matey) => {
            theCaptain = matey;
            if (matey) {
                if (!matey.isAnonymous) {
                    document.body.classList.add('is-admin');
                    document.getElementById('pass-input-area').style.display = 'none';
                    document.getElementById('jack-speak').innerText = "Captain on deck!";
                } else {
                    document.body.classList.remove('is-admin');
                    document.getElementById('jack-speak').innerText = "Fair winds, traveler.";
                }
                listenToTheSea();
            } else {
                signInAnonymously(quartermaster).catch(arrgh => {
                    console.warn("The compass is spinning! Public view only.", arrgh.message);
                    listenToTheSea();
                });
                document.body.classList.remove('is-admin');
                document.getElementById('admin-btn').style.display = 'block';
            }
        });


        function listenToTheSea() {
            if (mainLogStream) mainLogStream();
            if (miniLogStream) miniLogStream();

            mainLogStream = onSnapshot(collection(mapRoom, theGreatTales), (snapshot) => {
                const stories = snapshot.docs.map(doc => doc.data()).sort((a, b) => b.timestamp - a.timestamp);
                revealTheTales(stories);
            }, (error) => {
                console.error("The sea rejects our query:", error);
                if (error.code === 'permission-denied') {
                    document.getElementById('jack-speak').innerText = "Mutiny! Permissions denied!";
                }
            });

            miniLogStream = onSnapshot(collection(mapRoom, theWhispers), (snapshot) => {
                const rumors = snapshot.docs.map(doc => doc.data()).sort((a, b) => b.timestamp - a.timestamp);
                revealTheWhispers(rumors);
            }, (error) => {
                console.error("The whispers fade away:", error);
            });
        }

        window.summonCaptain = () => {
            document.getElementById('pass-input-area').style.display = 'block';
            document.getElementById('admin-btn').style.display = 'none';
        };

        window.identifyCaptain = async () => {
            const ident = document.getElementById('captain-email');
            const secret = document.getElementById('captain-pass');
            const btn = document.getElementById('login-trigger');

            const email = ident.value.trim();
            const password = secret.value.trim();

            if (!email || !password) {
                document.getElementById('jack-speak').innerText = "State your name and purpose, matey!";
                return;
            }

            btn.disabled = true;
            btn.innerText = "Consulting the Kraken...";

            try {
                await signInWithEmailAndPassword(quartermaster, email, password);
                secret.value = "";
                ident.value = "";
            } catch (error) {
                document.getElementById('jack-speak').innerText = "Parlay failed! Wrong key.";
                secret.value = "";
            } finally {
                btn.disabled = false;
                btn.innerText = "Unlock";
            }
        };

        window.abandonShip = async () => {
            try {
                await signOut(quartermaster);
                document.getElementById('jack-speak').innerText = "The Captain has left the ship.";
            } catch (error) {
                console.error("The Captain refuses to leave:", error);
            }
        };

        window.spillTheInk = async (type) => {
            if (!theCaptain || theCaptain.isAnonymous) return;
            const titleInput = document.getElementById(type === 'main' ? 'post-title' : 'mini-title');
            const contentInput = document.getElementById('post-content');
            const title = titleInput.value.trim();
            const content = type === 'main' ? contentInput.value.trim() : "";

            if (!title) return;

            try {
                const destination = type === 'main' ? theGreatTales : theWhispers;
                await addDoc(collection(mapRoom, destination), {
                    title,
                    content,
                    timestamp: Date.now(),
                    captain_log: true,
                    authorId: theCaptain.uid
                });
                titleInput.value = "";
                if (type === 'main') contentInput.value = "";
                document.getElementById('jack-speak').innerText = "It's recorded in the stars.";
            } catch (e) {
                document.getElementById('jack-speak').innerText = "The ink has dried up!";
            }
        };

        window.signTheArticles = async () => {
            const birdAddress = document.getElementById('sub-email');
            const currentStatus = document.getElementById('sub-status');
            const email = birdAddress.value.trim();

            if (!email || !email.includes('@')) {
                currentStatus.innerText = "That bird won't fly! Check the address.";
                return;
            }

            try {
                await addDoc(collection(mapRoom, theArticles), {
                    email: email,
                    joined: Date.now()
                });
                birdAddress.value = "";
                currentStatus.innerText = "Welcome aboard the crew!";
            } catch (e) {
                currentStatus.innerText = "The quill broke. Try later.";
            }
        };

        function revealTheTales(posts) {
            const deck = document.getElementById('blog-posts');
            deck.innerHTML = posts.length ? "" : "<p>The manifest remains a mystery...</p>";
            posts.forEach(post => {
                const article = document.createElement('div');
                article.className = 'post-item';
                article.innerHTML = `<h3>${purify(post.title)}</h3><p>${purify(post.content)}</p>`;
                deck.appendChild(article);
            });
        }

        function revealTheWhispers(logs) {
            const list = document.getElementById('mini-log-list');
            list.innerHTML = "";
            logs.forEach(log => {
                const li = document.createElement('li');
                const moment = new Date(log.timestamp);
                const day = moment.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' });
                const bell = moment.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                li.innerHTML = `
                    <span class="timestamp-label">${day} @ ${bell}</span>
                    ${purify(log.title)}
                `;
                list.appendChild(li);
            });
        }

        function purify(text) {
            const bin = document.createElement('div');
            bin.textContent = (text || "");
            return bin.innerHTML;
        }

        window.blowOutTheCandle = () => document.getElementById('hull').classList.toggle('night-mode');

        // THE COMPASS THAT DOESN'T POINT NORTH
        document.addEventListener('mousemove', (e) => {
            const needle = document.getElementById('needle');
            const frame = needle.getBoundingClientRect();
            if (!frame) return;
            const angle = Math.atan2(e.clientY - (frame.top + 60), e.clientX - (frame.left + 60));
            needle.style.transform = `rotate(${angle * (180 / Math.PI) + 90}deg)`;
        });

        /*
        Hey future dev,

        You‚Äôre welcome to read this, learn from it, judge my life choices,
        or quietly improve it in your own fork.

        Please don‚Äôt reuse, scrape, or lift the API keys, endpoints, or backend setup.
        They‚Äôre tied to real services, real limits, and a very real person
        who does not enjoy surprise bills or broken dashboards.

        Build your own version. You‚Äôll understand it better anyway.
        */
    </script>
</body>

</html>
